<!DOCTYPE html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="description" content="An end-to-end solution for building high-quality PWAs">
  <title>Building & Deploying &ndash; PWA Starter Kit</title>
  <link rel="shortcut icon" sizes="32x32" href="/images/icon-32.png">
  <meta name="theme-color" content="#000">
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>
  <nav class="main-nav">
    <a class="logo" href="/">PWA Starter Kit</a>
    <div class="flex"></div>
    <a class="main-nav-item" href="https://github.com/polymer/pwa-starter-kit">Github</a>
    <a class="main-nav-item" href="/Setup">Get Started</a>
    <a class="main-nav-item" href="/What's-in-the-box">Sample apps</a>
  </nav>

  <main>
  <nav class="toc">
    <ul data-depth="1">
      <li data-level="H2">
        <a href="/What's-in-the-box/">What's In The Box</a>
      </li>
      <ul data-depth="2">
        <li data-level="H2">
          <a href="/Setup/">Setup</a>
        </li>
        <li data-level="H2">
          <a href="/Browser-support/">Browser Support</a>
        </li>
        <li data-level="H2">
          <a href="/Home/">Sample apps</a>
        </li>
      </ul>
      <li data-level="H2">
        <a href="/Configuring-and-personalizing/">Configuring And Personalizing</a>
      </li>

      <li data-level="H2">
        <a href="/Redux-and-state-management/">Redux And State Management</a>
      </li>

      <li data-level="H2">
        <a href="/Building-&amp;-Deploying/">Building &amp; Deploying</a>
      </li>

      <li data-level="H2">Testing</li>
      <ul data-depth="2">
        <li data-level="H2">
          <a href="/Performance-testing/">Performance Testing</a>
        </li>
        <li data-level="H2">
          <a href="/Application-testing/">Application Testing</a>
        </li>
      </ul>
    </ul>
  </nav>

  <article>
    <h1>
      Building & Deploying
    </h1>

    <p>This page will take you through the steps you need to do to build and deploy your application to production.</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#prpl-server-recommended">prpl-server (recommended)</a>
    <ul>
      <li><a href="#building-for-prpl-server">Building for prpl-server</a></li>
      <li><a href="#previewing-prpl-server">Previewing prpl-server</a></li>
      <li><a href="#deploying-prpl-server-to-app-engine">Deploying prpl-server to App Engine</a></li>
    </ul>
  </li>
  <li><a href="#static-hosting">Static hosting</a>
    <ul>
      <li><a href="#building-for-static-hosting">Building for static hosting</a></li>
      <li><a href="#previewing-static-hosting">Previewing static hosting</a></li>
      <li><a href="#deploying-static-hosting">Deploying static hosting</a>
        <ul>
          <li><a href="#app-engine">App Engine</a></li>
          <li><a href="#firebase-hosting">Firebase Hosting</a></li>
          <li><a href="#netlify">Netlify</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#service-worker">Service Worker</a></li>
</ul>

<h2 id="prpl-server-recommended"><code class="highlighter-rouge">prpl-server</code> (recommended)</h2>
<p><a href="https://github.com/Polymer/prpl-server-node">prpl-server</a> is a node server that uses differential serving to deliver the optimal response for each browser. Our provided configuration (<a href="https://github.com/Polymer/pwa-starter-kit/blob/master/polymer.json"><code class="highlighter-rouge">polymer.json</code></a>) supports the following responses:</p>

<ul>
  <li><code class="highlighter-rouge">esm-bundled</code> - Bundled ES modules for browsers that support ES modules</li>
  <li><code class="highlighter-rouge">es6-bundled</code> - Bundled ES6/2015 code using <a href="http://requirejs.org/docs/whyamd.html">AMD</a> for other browsers that support ES6/2015</li>
  <li><code class="highlighter-rouge">es5-bundled</code> - Bundled ES5 code using <a href="http://requirejs.org/docs/whyamd.html">AMD</a> for other browsers</li>
  <li>Server-side rendered pages (with <a href="https://github.com/GoogleChrome/rendertron">Rendertron</a>) for supported bots/web crawlers</li>
</ul>

<h3 id="building-for-prpl-server">Building for <code class="highlighter-rouge">prpl-server</code></h3>
<p>To run the build:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run build:prpl-server
</code></pre></div></div>

<p>This will populate the <code class="highlighter-rouge">server/build/</code> directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server/
├── build/
|   └── es5-bundled/
|   └── es6-bundled/
|   └── esm-bundled/
|   └── polymer.json
├── app.yaml
├── package-lock.json
└── package.json
</code></pre></div></div>

<h3 id="previewing-prpl-server">Previewing <code class="highlighter-rouge">prpl-server</code></h3>
<p>To preview the build using prpl-server locally:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run serve:prpl-server
</code></pre></div></div>

<h3 id="deploying-prpl-server-to-app-engine">Deploying <code class="highlighter-rouge">prpl-server</code> to App Engine</h3>
<p>The contents of <code class="highlighter-rouge">server/app.yaml</code> is pre-configured to be deployed to Google App Engine (e.g. <code class="highlighter-rouge">gcloud app deploy server/app.yaml</code>). The provided <code class="highlighter-rouge">server/package.json</code> can also be used on other hosting services that support Node.js.</p>

<h2 id="static-hosting">Static hosting</h2>
<p>If you don’t need differential serving and want to serve the same build to all browsers, you can just deploy to a static server.</p>

<h3 id="building-for-static-hosting">Building for static hosting</h3>
<p>To build the production site, run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run build:static
</code></pre></div></div>

<p>This will create three different build outputs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build/
├── es5-bundled/
├── es6-bundled/
├── esm-bundled/
└── ...
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">esm-bundled</code> - Bundled ES modules for browsers that support ES modules</li>
  <li><code class="highlighter-rouge">es6-bundled</code> - Bundled ES6/2015 code using <a href="http://requirejs.org/docs/whyamd.html">AMD</a> for other browsers that support ES6/2015</li>
  <li><code class="highlighter-rouge">es5-bundled</code> - Bundled ES5 code using <a href="http://requirejs.org/docs/whyamd.html">AMD</a> for other browsers</li>
</ul>

<h3 id="previewing-static-hosting">Previewing static hosting</h3>
<p>To preview it locally, run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run serve:static
</code></pre></div></div>

<p>Our provided configuration will serve the <code class="highlighter-rouge">es5-bundled</code> build. If you don’t need to support legacy browsers,  you can use a more modern build by modifying the <code class="highlighter-rouge">serve:static</code> script in package.json to use <code class="highlighter-rouge">es6-bundled</code> or <code class="highlighter-rouge">esm-bundled</code> instead. Be sure that all page navigation requests are served the contents of <code class="highlighter-rouge">index.html</code>.</p>

<h3 id="deploying-static-hosting">Deploying static hosting</h3>
<p>By default, static hosting servers aren’t set up to work with single page apps (SPAs) – in particular, the problem is that an SPA uses routes that do not correspond to full file path names. For example, in <code class="highlighter-rouge">pwa-starter-kit</code> the second view’s URL is <code class="highlighter-rouge">http://localhost:8081/view2</code>, but that doesn’t correspond to a file that the browser can use. Each static hosting server has a different approach to working around this:</p>

<h4 id="app-engine">App Engine</h4>
<p>Download the <a href="https://cloud.google.com/appengine/downloads">Google App Engine SDK</a> and follow the instructions for your platform to install it. Here we are using Python SDK.</p>

<p><a href="https://cloud.google.com/appengine">Sign up for an App Engine account</a> and go to <a href="https://pantheon.corp.google.com/cloud-resource-manager">project dashboard</a> page to create a new project. Make note of the project ID associated with your project.</p>

<p>Create an App Engine config file (<code class="highlighter-rouge">app.yaml</code>) with the following:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">runtime</span><span class="pi">:</span> <span class="s">python27</span>
<span class="na">api_version</span><span class="pi">:</span> <span class="s">1</span>
<span class="na">threadsafe</span><span class="pi">:</span> <span class="s">yes</span>

<span class="na">handlers</span><span class="pi">:</span>

<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/images</span>
  <span class="na">static_dir</span><span class="pi">:</span> <span class="s">build/es5-bundled/images</span>
  <span class="na">secure</span><span class="pi">:</span> <span class="s">always</span>

<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/node_modules</span>
  <span class="na">static_dir</span><span class="pi">:</span> <span class="s">build/es5-bundled/node_modules</span>
  <span class="na">secure</span><span class="pi">:</span> <span class="s">always</span>

<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/src</span>
  <span class="na">static_dir</span><span class="pi">:</span> <span class="s">build/es5-bundled/src</span>
  <span class="na">secure</span><span class="pi">:</span> <span class="s">always</span>

<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/manifest.json</span>
  <span class="na">static_files</span><span class="pi">:</span> <span class="s">build/es5-bundled/manifest.json</span>
  <span class="na">upload</span><span class="pi">:</span> <span class="s">build/es5-bundled/manifest.json</span>
  <span class="na">secure</span><span class="pi">:</span> <span class="s">always</span>

<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/service-worker.js</span>
  <span class="na">static_files</span><span class="pi">:</span> <span class="s">build/es5-bundled/service-worker.js</span>
  <span class="na">upload</span><span class="pi">:</span> <span class="s">build/es5-bundled/service-worker.js</span>
  <span class="na">secure</span><span class="pi">:</span> <span class="s">always</span>

<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/.*</span>
  <span class="na">static_files</span><span class="pi">:</span> <span class="s">build/es5-bundled/index.html</span>
  <span class="na">upload</span><span class="pi">:</span> <span class="s">build/es5-bundled/index.html</span>
  <span class="na">secure</span><span class="pi">:</span> <span class="s">always</span>

<span class="na">skip_files</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">build/es6-bundled/</span>
<span class="pi">-</span> <span class="s">build/esm-bundled/</span>
<span class="pi">-</span> <span class="s">images/</span>
<span class="pi">-</span> <span class="s">node_modules/</span>
<span class="pi">-</span> <span class="s">server/</span>
<span class="pi">-</span> <span class="s">src/</span>
<span class="pi">-</span> <span class="s">test/</span>
</code></pre></div></div>

<p>To deploy your project:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcloud app deploy --project &lt;project_ID&gt;
</code></pre></div></div>

<h4 id="firebase-hosting">Firebase Hosting</h4>
<p><a href="https://firebase.google.com/docs/hosting/">Firebase</a> provides easy http2-enabled static hosting, a real-time database, server functions, and edge-caching all over the globe.</p>

<p>Install the Firebase CLI:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install -g firebase-tools
</code></pre></div></div>
<p><a href="https://www.firebase.com/signup/">Sign up for a Firebase account</a> if you don’t have one. Then go to <a href="https://www.firebase.com/">Firebase Console</a> to create a new project. Make note of the project ID associated with your project.</p>

<p>Login to the Firebase and set the previously created project as the active Firebase project for your working directory:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firebase login
firebase use &lt;project_ID&gt;
</code></pre></div></div>

<p>Create a Firebase config file (<code class="highlighter-rouge">firebase.json</code>) with the following:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"hosting"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"public"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build/es5-bundled/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"rewrites"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"**/!(*.*)"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"destination"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/index.html"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>To deploy your project:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firebase deploy
</code></pre></div></div>

<h4 id="netlify">Netlify</h4>
<p><a href="https://www.netlify.com/">Netlify</a> has built-in <a href="https://www.netlify.com/docs/continuous-deployment/">Continuous Deployment</a> which automatically runs your build commands and deploys the result whenever you push to your Git repository.</p>

<p>Create a <code class="highlighter-rouge">_redirects</code> file with the following <a href="https://www.netlify.com/docs/redirects/">rewrite rules</a>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*    /index.html   200
</code></pre></div></div>
<p>Go to <a href="https://app.netlify.com/signup">netlify project</a> page and setup the Git hosting for the new project. In <code class="highlighter-rouge">Basic build settings</code>, put <code class="highlighter-rouge">npm run build:static</code> as the build command and <code class="highlighter-rouge">build/es5-bundled</code> as the publish directory.</p>

<p>Click <code class="highlighter-rouge">Deploy site</code>.</p>

<h2 id="service-worker">Service Worker</h2>
<p>A Service Worker is loaded and registered in the <a href="https://github.com/Polymer/pwa-starter-kit/blob/master/index.html#L68"><code class="highlighter-rouge">index.html</code></a> file. However, during development (to make debugging easier), the Service Worker does not actually exist, and only a <a href="https://github.com/Polymer/pwa-starter-kit/blob/master/service-worker.js">stub</a> file is used.</p>

<p>The production time Service Worker is automatically created during build time, i.e. by running <code class="highlighter-rouge">npm run build:static</code> or <code class="highlighter-rouge">npm run build:prpl-server</code>. This file is generated based on the <a href="https://github.com/Polymer/pwa-starter-kit/blob/master/polymer.json"><code class="highlighter-rouge">polymer.json</code></a> configuration file, and you can find it under each of the build directories:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build/
├── es5-bundled/
|   └── service-worker.js
├── es6-bundled/
|   └── service-worker.js
├── esm-bundled/
|   └── service-worker.js
└── ...
</code></pre></div></div>

<p>By default, all of the source files (inside the <code class="highlighter-rouge">/src</code> directory) will be pre-cached, as specified in the <a href="https://github.com/Polymer/pwa-starter-kit/blob/master/sw-precache-config.js"><code class="highlighter-rouge">sw-precache-config.js</code></a> configuration file. If you want to change this behaviour, check out the <a href="https://www.polymer-project.org/2.0/toolbox/service-worker"><code class="highlighter-rouge">sw-precache-config</code> docs</a>.</p>

  </article>
</main>


  <footer>
    <a target="_blank" href="http://polymer.github.io/LICENSE.txt" data-outbound="license-txt">© 2018 Google</a>
  </footer>
</body>
</html>
